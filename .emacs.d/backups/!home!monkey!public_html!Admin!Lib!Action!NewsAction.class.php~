<?php

class NewsAction extends MyAction
{
	public function index()
	{
		$news = D('NewsView');
		import("@.Util.Page");
    	$ncid = $_GET['ncid'];
    	if($ncid){
        	$condition = "News.ncategory_id='$ncid'";
        }else{
        	$condition = '1=1';
        }
		$count = $news->where($condition)->count();
		$p = new Page($count,10);
		$p->setConfig('header',"篇新闻");
		$p->setConfig('first', '首页');
        $p->setConfig('last', '尾页'); 
        
		$nList = $news->where($condition)->order("npt DESC")->limit($p->firstRow . ',' . $p->listRows)->select();
		$page = $p->show();
		$this->assign("page",$page);
		$this->assign("nList",$nList);

		$ncategory = M("Ncategory");
		$ncList = $ncategory->select();
		$this->assign("ncList",$ncList);
		
		$this->display();
	}
	
	public function add()
	{
		$ncategory = M("Ncategory");
		$ncList = $ncategory->select();
		$this->assign("ncList",$ncList);
		
		$this->display();
	}
	
	public function insert()
	{
		$news = M("News");
		$news->create();
		$news->add();
		$this->redirect('index');
	}
	public function edit()
	{
		$id = $_GET['id'];
		$news = M("News");
		$nVO = $news->where("id='$id'")->find();
		$this->assign("nVO",$nVO);
		$ncategory = M("Ncategory");
		$ncList = $ncategory->select();
		$this->assign("ncList",$ncList);
		
		$this->display();
	}
	public function save()
	{
		$id = $_GET['id'];
		$news = M("News");
		$news->create();
		$news->where("id='$id'")->save();
		$this->redirect('index');
	}
}